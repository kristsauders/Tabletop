{"ts":1347042974591,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var express = require('express'),\n\tapp = express.createServer(),\n\trest = require('restler'),\n\tejs = require('ejs'),\n\tmongo = require('mongodb'),\n\turl = require(\"url\"),\n\tfs = require('fs'),\n\tsys = require('sys'),\n\tdb = new mongo.Db('tabletop', new mongo.Server(\"127.0.0.1\", 27017, {\n\t\tauto_reconnect: true\n\t}), {}),\n\tim = require('imagemagick');\n\nim.identify.path = '/usr/bin/identify';\nim.convert.path = '/usr/bin/convert';\n\napp.use(express.cookieParser());\napp.use(express.session({\n\tsecret: \"thisIsSparta!\"\n}));\napp.use(express.bodyParser({\n\tuploadDir: __dirname + '/images'\n}));\n\napp.set('view engine', 'ejs');\napp.set('views', __dirname + '/views');\napp.use('/js', express.static(__dirname + '/js'));\napp.use('/images', express.static(__dirname + '/images'));\n\napp.get('/:user/:gallery/draw', function(req, res) {\n    console.log('got draw request');\n    res.render('draw', {\n\t\tlayout: false,\n\t\tdata: {}\n\t});\n});\n\napp.get('/:user/:gallery/photos/new', function(req, res) {\n    console.log('got new photo get');\n\tres.send('<form method=\"post\" enctype=\"multipart/form-data\">' + '<p>Image: <input type=\"file\" name=\"image\" multiple/></p>' + '<p><input type=\"submit\" value=\"Upload\" /></p>' + '</form>');\n});\n\nfunction processUpload(req, res) {\n    im.convert([req.files.image.path, '-quality', '85', '-resize', '900x900\\>', req.files.image.path.split('.')[0] + '-medium.jpg'], function(err) {\n    \tif (err) throw err;\n\t});\n    \n    im.convert([req.files.image.path, '-quality', '85', '-resize', '1600x1600\\>', req.files.image.path.split('.')[0] + '-large.jpg'], function(err) {\n        if (err) throw err;\n\t});\n    \n\tim.convert([req.files.image.path, '-quality', '80', '-resize', '400x400\\>', req.files.image.path.split('.')[0] + '-small.jpg'], function(err) {\n\t\tif (err) throw err;\n\t\tdb.open(function(err, db) {\n\t\t\tdb.collection('users', function(err, collection) {\n\t\t\t\tcollection.findOne({\n\t\t\t\t\t\"user\": req.params.user\n\t\t\t\t}, function(err, document) {\n\t\t\t\t\tvar gal = document.galleries[req.params.gallery];\n\t\t\t\t\tvar p = 0;\n\t\t\t\t\tfor (var i in gal) p += 1;\n\t\t\t\t\tgal[p] = new Object();\n\t\t\t\t\tgal[p].source = '/images/' + req.files.image.path.split('/').pop()+'.jpg';;\n\t\t\t\t\tgal[p].top = Math.floor(Math.random() * 701);\n\t\t\t\t\tgal[p].left = Math.floor(Math.random() * 901);\n\t\t\t\t\tgal[p].link = '';\n\t\t\t\t\tim.identify(req.files.image.path, function(err, features) {\n\t\t\t\t\t\tvar ratio = features.width / features.height;\n\t\t\t\t\t\tgal[p].width = Math.round(Math.random() * 100) + 150;\n\t\t\t\t\t\tgal[p].height = Math.round(gal[p].width / ratio);\n\t\t\t\t\t\tdocument.galleries[req.params.gallery] = gal;\n\t\t\t\t\t\tcollection.update({\n\t\t\t\t\t\t\t\"user\": req.params.user\n\t\t\t\t\t\t}, document, {\n\t\t\t\t\t\t\tupsert: true,\n\t\t\t\t\t\t\tsafe: true\n\t\t\t\t\t\t}, function(err, document) {\n\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\tres.redirect('back');\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n}\n\nfunction processUploads(req, res, k) {\n\tif (req.files.image[k]) {\n\t\tim.convert([req.files.image[k].path, '-quality', '85', '-resize', '900x900\\>', req.files.image[k].path.split('.')[0] + '-medium.jpg'], function(err) {\n\t\t\tif (err) throw err;\n\t\t});\n\t\n\t\tim.convert([req.files.image[k].path, '-quality', '85', '-resize', '1600x1600\\>', req.files.image[k].path.split('.')[0] + '-large.jpg'], function(err) {\n\t\t\tif (err) throw err;\n\t\t});\n        \n\t\tim.convert([req.files.image[k].path, '-quality', '80', '-resize', '400x400\\>', req.files.image[k].path.split('.')[0] + '-small.jpg'], function(err) {\n\t\t\tif (err) throw err;\n\t\t\tdb.open(function(err, db) {\n\t\t\t\tdb.collection('users', function(err, collection) {\n\t\t\t\t\tcollection.findOne({\n\t\t\t\t\t\t\"user\": req.params.user\n\t\t\t\t\t}, function(err, document) {\n\t\t\t\t\t\tvar gal = document.galleries[req.params.gallery];\n\t\t\t\t\t\tvar p = 0;\n\t\t\t\t\t\tfor (var i in gal) p += 1;\n\t\t\t\t\t\tgal[p] = new Object();\n\t\t\t\t\t\tgal[p].source = '/images/' + req.files.image[k].path.split('/').pop()+'.jpg';\n\t\t\t\t\t\tgal[p].top = Math.floor(Math.random() * 701);\n\t\t\t\t\t\tgal[p].left = Math.floor(Math.random() * 901);\n\t\t\t\t\t\tgal[p].link = '';\n\t\t\t\t\t\tim.identify(req.files.image[k].path, function(err, features) {\n\t\t\t\t\t\t\tvar ratio = features.width / features.height;\n\t\t\t\t\t\t\tgal[p].width = Math.round(Math.random() * 100) + 150;\n\t\t\t\t\t\t\tgal[p].height = Math.round(gal[p].width / ratio);\n\t\t\t\t\t\t\tdocument.galleries[req.params.gallery] = gal;\n\t\t\t\t\t\t\tcollection.update({\n\t\t\t\t\t\t\t\t\"user\": req.params.user\n\t\t\t\t\t\t\t}, document, {\n\t\t\t\t\t\t\t\tupsert: true,\n\t\t\t\t\t\t\t\tsafe: true\n\t\t\t\t\t\t\t}, function(err, document) {\n\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\tk += 1;\n\t\t\t\t\t\t\t\tprocessUploads(req, res, k);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t}\n\telse {\n\t\tres.redirect('back');\n\t}\n}\n\napp.post('/:user/:gallery/photos/new', function(req, res, next) {\n    console.log('got new photo post');\n\tif (req.files.image.path) processUpload(req, res);\n\telse {\n\t\tprocessUploads(req, res, 0);\n\t}\n});\n\napp.post('/:user/:gallery/photos/drawn/uploadDrawnImage', function(req, res) {\n    console.log('Got uploaded drawn image');\n    var data = req.body.f1.replace(/^data:image\\/\\w+;base64,/, \"\");\n\tvar buf = new Buffer(data, 'base64');\n    var path = __dirname + '/images/' + Math.round(Math.random()*100000) + '.png';\n\tfs.writeFile(path, buf, function() {\n        im.convert([path, '-quality', '85', '-resize', '900x900\\>', path.split('.')[0] + '-medium.png'], function(err) {\n            if (err) throw err;\n        });\n    \n        im.convert([path, '-quality', '85', '-resize', '1600x1600\\>', path.split('.')[0] + '-large.png'], function(err) {\n            if (err) throw err;\n    \t});\n        \n    \tim.convert([path, '-quality', '80', '-resize', '400x400\\>', path.split('.')[0] + '-small.png'], function(err) {\n    \t\tif (err) throw err;\n    \t\tdb.open(function(err, db) {\n    \t\t\tdb.collection('users', function(err, collection) {\n    \t\t\t\tcollection.findOne({\n    \t\t\t\t\t\"user\": req.params.user\n    \t\t\t\t}, function(err, document) {\n    \t\t\t\t\tvar gal = document.galleries[req.params.gallery];\n    \t\t\t\t\tvar p = 0;\n    \t\t\t\t\tfor (var i in gal) p += 1;\n    \t\t\t\t\tgal[p] = new Object();\n    \t\t\t\t\tgal[p].source = '/images/' + path.split('/').pop()+'.jpg';;\n    \t\t\t\t\tgal[p].top = Math.floor(Math.random() * 701);\n    \t\t\t\t\tgal[p].left = Math.floor(Math.random() * 901);\n    \t\t\t\t\tgal[p].link = '';\n    \t\t\t\t\tim.identify(path, function(err, features) {\n    \t\t\t\t\t\tvar ratio = features.width / features.height;\n    \t\t\t\t\t\tgal[p].width = Math.round(Math.random() * 100) + 150;\n    \t\t\t\t\t\tgal[p].height = Math.round(gal[p].width / ratio);\n    \t\t\t\t\t\tdocument.galleries[req.params.gallery] = gal;\n    \t\t\t\t\t\tcollection.update({\n    \t\t\t\t\t\t\t\"user\": req.params.user\n    \t\t\t\t\t\t}, document, {\n    \t\t\t\t\t\t\tupsert: true,\n    \t\t\t\t\t\t\tsafe: true\n    \t\t\t\t\t\t}, function(err, document) {\n    \t\t\t\t\t\t\tdb.close();\n    \t\t\t\t\t\t\tres.redirect('back');\n    \t\t\t\t\t\t});\n    \t\t\t\t\t});\n    \t\t\t\t});\n    \t\t\t});\n    \t\t});\n    \t});\n    });\n});\n\napp.post('/:user/:gallery/uploadBackground', function(req, res, next) {\n    console.log('gotten background');\n\tvar data = req.body.f1.replace(/^data:image\\/\\w+;base64,/, \"\");\n\tvar buf = new Buffer(data, 'base64');\n\tfs.writeFile(__dirname + '/images/' + req.params.user + '-' + req.params.gallery + '-bg.png', buf);\n\tres.redirect('back');\n});\n\napp.post('/:user/:gallery/photos/newlink', function(req, res, next) {\n    console.log('got new link photo');\n    im.convert([req.files.image.path, '-quality', '85', '-resize', '900x900\\>', req.files.image.path.split('.')[0] + '-medium.jpg'], function(err) {\n        if (err) throw err;\n\t});\n    \n    im.convert([req.files.image.path, '-quality', '85', '-resize', '1600x1600\\>', req.files.image.path.split('.')[0] + '-large.jpg'], function(err) {\n        if (err) throw err;\n\t});\n    \n\tim.convert([req.files.image.path, '-quality', '50', '-resize', '400x400\\>', req.files.image.path.split('.')[0] + '-small.jpg'], function(err) {\n\t\tif (err) throw err;\n\t\tdb.open(function(err, db) {\n\t\t\tdb.collection('users', function(err, collection) {\n\t\t\t\tcollection.findOne({\n\t\t\t\t\t\"user\": req.params.user\n\t\t\t\t}, function(err, document) {\n\t\t\t\t\tvar gal = document.galleries[req.params.gallery];\n\t\t\t\t\tvar p = 0;\n\t\t\t\t\tfor (var i in gal) p += 1;\n\t\t\t\t\tgal[p] = new Object();\n\t\t\t\t\tgal[p].source = '/images/' + req.files.image.path.split('/').pop()+'.jpg';;\n\t\t\t\t\tgal[p].top = Math.floor(Math.random() * 701);\n\t\t\t\t\tgal[p].left = Math.floor(Math.random() * 901);\n\t\t\t\t\tgal[p].link = req.body.link;\n\t\t\t\t\tim.identify(req.files.image.path, function(err, features) {\n\t\t\t\t\t\tvar ratio = features.width / features.height;\n\t\t\t\t\t\tgal[p].width = Math.round(Math.random() * 100) + 150;\n\t\t\t\t\t\tgal[p].height = Math.round(gal[p].width / ratio);\n\t\t\t\t\t\tdocument.galleries[req.params.gallery] = gal;\n\t\t\t\t\t\tcollection.update({\n\t\t\t\t\t\t\t\"user\": req.params.user\n\t\t\t\t\t\t}, document, {\n\t\t\t\t\t\t\tupsert: true,\n\t\t\t\t\t\t\tsafe: true\n\t\t\t\t\t\t}, function(err, document) {\n\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\tres.redirect('back');\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n});\n\napp.get('/:user/:gallery', function(req, res) {\n    //req.session.user = 'krists';\n\tdb.open(function(err, db) {\n\t\tdb.collection('users', function(err, collection) {\n\t\t\tcollection.findOne({\n\t\t\t\t\"user\": req.params.user\n\t\t\t}, function(err, document) {\n\t\t\t\tif (document) {\n\t\t\t\t\tif (document.galleries[req.params.gallery]) {\n\t\t\t\t\t\tif (req.session.user == req.params.user) res.render('index', {\n\t\t\t\t\t\t\tlayout: false,\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\timages: document.galleries[req.params.gallery],\n\t\t\t\t\t\t\t\tparams: req.params\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\telse res.render('public', {\n\t\t\t\t\t\t\tlayout: false,\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\timages: document.galleries[req.params.gallery],\n\t\t\t\t\t\t\t\tparams: req.params\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse res.send('Gallery does not exist!');\n\t\t\t\t}\n\t\t\t\telse res.send('User does not exist!');\n\t\t\t\tdb.close();\n\t\t\t});\n\t\t});\n\t});\n});\n\napp.post('/:user/:gallery/upsert', function(req, res) {\n    console.log('upsert');\n\tdb.open(function(err, db) {\n\t\tdb.collection('users', function(err, collection) {\n\t\t\tcollection.findOne({\n\t\t\t\t\"user\": req.params.user\n\t\t\t}, function(err, document) {\n\t\t\t\tvar gal = document.galleries[req.params.gallery];\n\t\t\t\tvar p = 0;\n\t\t\t\tfor (var i in gal) {\n\t\t\t\t\tif (gal[p].source.split('/').pop() == req.body.image) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp += 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tgal[p].source = '/images/' + req.body.image;\n\t\t\t\tgal[p].top = req.body.top;\n\t\t\t\tgal[p].left = req.body.side;\n\t\t\t\tgal[p].width = req.body.width;\n\t\t\t\tgal[p].height = req.body.height;\n\t\t\t\tgal[p].z = req.body.z;\n\t\t\t\tdocument.galleries[req.params.gallery] = gal;\n\t\t\t\tcollection.update({\n\t\t\t\t\t\"user\": req.params.user\n\t\t\t\t}, document, {\n\t\t\t\t\tupsert: true,\n\t\t\t\t\tsafe: true\n\t\t\t\t}, function(err, document) {\n\t\t\t\t\tdb.close();\n\t\t\t\t});\n\t\t\t\tres.redirect('back');\n\t\t\t});\n\t\t});\n\t});\n});\n\napp.post('/:user/:gallery/photos/delete', function(req, res) {\n    console.log('delete photo');\n\tdb.open(function(err, db) {\n\t\tdb.collection('users', function(err, collection) {\n\t\t\tcollection.findOne({\n\t\t\t\t\"user\": req.params.user\n\t\t\t}, function(err, document) {\n\t\t\t\tvar gal = document.galleries[req.params.gallery];\n\t\t\t\tvar p = 0;\n\t\t\t\tfor (var i in gal) {\n\t\t\t\t\tif (gal[p].source.split('/').pop() == req.body.file) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp += 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar pp = 0;\n\t\t\t\twhile (true) {\n\t\t\t\t\tif (pp >= p) {\n\t\t\t\t\t\tif (gal[pp + 1]) {\n\t\t\t\t\t\t\tgal[pp] = gal[pp + 1];\n\t\t\t\t\t\t\tdelete gal[pp + 1];\n\t\t\t\t\t\t\tpp += 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tif (pp == p) delete gal[pp];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tpp += 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdocument.galleries[req.params.gallery] = gal;\n\t\t\t\tcollection.update({\n\t\t\t\t\t\"user\": req.params.user\n\t\t\t\t}, document, {\n\t\t\t\t\tupsert: true,\n\t\t\t\t\tsafe: true\n\t\t\t\t}, function(err, document) {\n\t\t\t\t\tdb.close();\n\t\t\t\t});\n\t\t\t\tres.redirect('back');\n\t\t\t});\n\t\t});\n\t});\n});\n\napp.get('/:user/:gallery/delete', function(req, res) {\n\tdb.open(function(err, db) {\n\t\tdb.collection('users', function(err, collection) {\n\t\t\tcollection.findOne({\n\t\t\t\t\"user\": req.params.user\n\t\t\t}, function(err, document) {\n\t\t\t\tvar gals = document.galleries;\n\t\t\t\tfor (var i in gals) {\n\t\t\t\t\tif (i == req.params.gallery) delete gals[i];\n\t\t\t\t}\n\t\t\t\tdocument.galleries = gals;\n\t\t\t\tcollection.update({\n\t\t\t\t\t\"user\": req.params.user\n\t\t\t\t}, document, {\n\t\t\t\t\tupsert: true,\n\t\t\t\t\tsafe: true\n\t\t\t\t}, function(err, document) {\n\t\t\t\t\tdb.close();\n\t\t\t\t});\n\t\t\t\tres.redirect('back');\n\t\t\t});\n\t\t});\n\t});\n});\n\napp.get('/:user/galleries/list', function(req, res) {\n\tdb.open(function(err, db) {\n\t\tdb.collection('users', function(err, collection) {\n\t\t\tcollection.findOne({\n\t\t\t\t\"user\": req.params.user\n\t\t\t}, function(err, document) {\n\t\t\t\tvar galleries = new Array();\n\t\t\t\tvar c = 0;\n\t\t\t\tfor (var i in document.galleries) {\n\t\t\t\t\tgalleries[c] = '/' + req.params.user + '/' + i;\n\t\t\t\t\tc += 1;\n\t\t\t\t}\n\t\t\t\tres.render('galleries', {\n\t\t\t\t\tlayout: false,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\t\"galleries\": galleries,\n\t\t\t\t\t\t\"user\": req.params.user\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tdb.close();\n\t\t\t});\n\t\t});\n\t});\n});\n\napp.get('/users/list/account/delete/:user', function(req, res) {\n    console.log('delete user ' + req.params.user);\n    db.open(function(err, db) {\n\t\tdb.collection('users', function(err, collection) {\n\t\t\tcollection.findOne({\n\t\t\t\t\"user\": req.params.user\n\t\t\t}, function(err, document) {\n\t\t\t\tcollection.remove({\n    \t\t\t\t\"user\": req.params.user\n\t\t\t\t}, function(err, document) {\n\t\t\t\t\tdb.close();\n                    res.redirect('back');\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n});\n\napp.post('/:user/galleries/new', function(req, res) {\n    console.log('new gallery');\n\tdb.open(function(err, db) {\n\t\tdb.collection('users', function(err, collection) {\n\t\t\tcollection.findOne({\n\t\t\t\t\"user\": req.params.user\n\t\t\t}, function(err, document) {\n\t\t\t\tif (!document.galleries[req.body.gallery]) {\n\t\t\t\t\tvar data = 'iVBORw0KGgoAAAANSUhEUgAABbIAAAQcCAYAAABAhG2nAAAgAElEQVR4nOzYoQHAIBDAwNL9J34DG2CJuJsgOmtm9gcAAAAAAFH/6wAAAAAAALgxsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAABIM7IBAAAAAEgzsgEAAAAASDOyAQAAAAA47dixAAAAAMAgf+tp7CiM1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAGCTOvMAAADkSURBVAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGBNZAMAAAAAsCayAQAAAABYE9kAAAAAAKyJbAAAAAAA1kQ2AAAAAABrIhsAAAAAgDWRDQAAAADAmsgGAAAAAGAtR1wMJSxM1GUAAAAASUVORK5CYII=';\n\t\t\t\t\tvar buf = new Buffer(data, 'base64');\n\t\t\t\t\tfs.writeFile(__dirname + '/images/' + req.params.user + '-' + req.body.gallery + '-bg.png', buf);\n\t\t\t\t\tvar gal = new Object();\n\t\t\t\t\tdocument.galleries[req.body.gallery] = gal;\n\t\t\t\t\tcollection.update({\n\t\t\t\t\t\t\"user\": req.params.user\n\t\t\t\t\t}, document, {\n\t\t\t\t\t\tupsert: true,\n\t\t\t\t\t\tsafe: true\n\t\t\t\t\t}, function(err, document) {\n\t\t\t\t\t\tdb.close();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tres.redirect('back');\n\t\t\t});\n\t\t});\n\t});\n});\n\napp.post('/users/list/new', function(req, res) {\n    console.log('new user');\n\tdb.open(function(err, db) {\n\t\tdb.collection('users', function(err, collection) {\n\t\t\tcollection.findOne({\n\t\t\t\t\"user\": req.body.user\n\t\t\t}, function(err, document) {\n\t\t\t\tif (!document) {\n\t\t\t\t\tdocument = new Object();\n\t\t\t\t\tdocument.user = req.body.user;\n                    document.password = req.body.password;\n\t\t\t\t\tdocument.galleries = {};\n\t\t\t\t\tcollection.update({\n\t\t\t\t\t\t\"user\": req.body.user\n\t\t\t\t\t}, document, {\n\t\t\t\t\t\tupsert: true,\n\t\t\t\t\t\tsafe: true\n\t\t\t\t\t}, function(err, document) {\n                        req.session.user = req.body.user;\n                        req.session.password = req.body.password;\n\t\t\t\t\t\tdb.close();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tres.redirect('/' + req.body.user + '/galleries/list');\n\t\t\t});\n\t\t});\n\t});\n});\n\napp.post('/users/list/login', function(req, res) {\n    console.log('login by ' + req.body.user);\n    db.open(function(err, db) {\n\t\tdb.collection('users', function(err, collection) {\n\t\t\tcollection.findOne({\n\t\t\t\t\"user\": req.body.user\n\t\t\t}, function(err, document) {\n\t\t\t\tif(document.password == req.body.password) {\n                    req.session.user = req.body.user;\n                    req.session.password = req.body.password;\n\t                res.redirect('/' + req.body.user + '/galleries/list');\n\t\t\t\t} else {\n                    res.redirect('back');\n\t\t\t\t}\n\t\t\t\tdb.close();\n\t\t\t});\n\t\t});\n\t});\n});\n\napp.get('/', function(req, res) {\n    res.redirect('/krists/home');\n});\n\napp.get('/admin', function(req, res) {\n\tdb.open(function(err, db) {\n\t\tdb.collection('users', function(err, collection) {\n\t\t\tcollection.find().toArray(function(err, document) {\n\t\t\t\tvar users = new Array();\n\t\t\t\tfor (var i = 0; i < document.length; i++) {\n\t\t\t\t\tusers[i] = document[i].user;\n\t\t\t\t}\n\t\t\t\tres.render('users', {\n\t\t\t\t\tlayout: false,\n\t\t\t\t\tdata: users\n\t\t\t\t});\n\t\t\t\tdb.close();\n\t\t\t});\n\t\t});\n\t});\n});\n\napp.get('/fbauth', function(req, res) {\n    console.log('Got request');\n\tvar appId = \"151679494937877\";    \n\tvar appSecret = \"1e919b67ac456f708d5827576e3dd2fa\";    \n\tvar myUrl = \"http://code.kristsauders.com:8085/fbauth\";\n\n\tvar code = url.parse(req.url, true).query.code;\n\n\t    \n\tif (!code) {        \n\t\tvar dialogUrl = \"http://www.facebook.com/dialog/oauth?scope=user_photos&client_id=\" + appId + \"&redirect_uri=\" + encodeURIComponent(myUrl);   \n        console.log('Redirecting to FBauth at ' + dialogUrl);\n        res.redirect(dialogUrl);\n\t\treturn;    \n\t}\n\n    console.log('Got request with code ' + code);\n\trest.get(\"https://graph.facebook.com/oauth/access_token?client_id=\" + appId + \"&redirect_uri=\" + encodeURIComponent(myUrl) + \"&client_secret=\" + appSecret + \"&code=\" + code).on('complete', function(data) {\n\t\tconsole.log('Got response from Facebook: ' + data);\n        req.session.token = data;\n\t\tres.redirect('/fbphotos');\n\t});\n});\n\napp.get('/fbphotos', function(req, res) {\n\trest.get(\"https://graph.facebook.com/me?\" + req.session.token).on('complete', function(data) {\n        console.log(data[0]);\n        console.log('User name is ' + data[0].name + ' and user ID is ' + data[0].id);\n        rest.get(\"https://graph.facebook.com/\" + data.id + \"/albums?\" + req.session.token).on('complete', function(data) {\n            console.log(data);\n//\t\tvar b = \"\";\n//\t\tfor (var i in data) {\n//\t\t\tb += '<br/>' + data[i].name + ' ' + data[i].id + ' <img src=\"' + data[i]['cover_photo'] + '\"/>';\n//\t\t}\n            res.send(data);\n        });\n//\t\tres.render('index', {\n//            layout: false,\n//            data: photos\n//            });\n\t});\n});\n\napp.get('/fbtest', function(req, res) {\n    rest.get(\"https://graph.facebook.com/me?access_token=AAACJ86JqXRUBAPzXmsaCNiZBttPxVLOtbw9P5zTJDpHjzUgu7vMS9zHpvbVE4FFXAPBVsEXFnK4DSF6uYEZCBZCbaSTIgZA9GzPgs9DoqlEBWYE63UhE\").on('complete', function(data) {\n        var r = JSON.parse(data);\n        //console.log(r);\n        console.log('User name is ' + r.name + ' and user ID is ' + r.id);\n        rest.get(\"https://graph.facebook.com/\" + r.id + \"/albums?access_token=AAACJ86JqXRUBAPzXmsaCNiZBttPxVLOtbw9P5zTJDpHjzUgu7vMS9zHpvbVE4FFXAPBVsEXFnK4DSF6uYEZCBZCbaSTIgZA9GzPgs9DoqlEBWYE63UhE\").on('complete', function(data) {\n            var p = JSON.parse(data);\n            var b = \"\";\n            for (var i in p.data) {\n            \tb += '<br/>' + p.data[i].name + ' ' + p.data[i].id + ' <img src=\"https://graph.facebook.com/' + p.data[i].id + '/picture?type=small&access_token=AAACJ86JqXRUBAPzXmsaCNiZBttPxVLOtbw9P5zTJDpHjzUgu7vMS9zHpvbVE4FFXAPBVsEXFnK4DSF6uYEZCBZCbaSTIgZA9GzPgs9DoqlEBWYE63UhE\">';\n            }\n            res.send(b);\n        });\n\t});\n});\n\napp.get('/fbtest2', function(req, res) {\n    rest.get(\"https://graph.facebook.com/me?access_token=AAACJ86JqXRUBAPzXmsaCNiZBttPxVLOtbw9P5zTJDpHjzUgu7vMS9zHpvbVE4FFXAPBVsEXFnK4DSF6uYEZCBZCbaSTIgZA9GzPgs9DoqlEBWYE63UhE\").on('complete', function(data) {\n        var r = JSON.parse(data);\n        //console.log(r);\n        console.log('User name is ' + r.name + ' and user ID is ' + r.id);\n        rest.get(\"https://graph.facebook.com/\" + r.id + \"/albums?access_token=AAACJ86JqXRUBAPzXmsaCNiZBttPxVLOtbw9P5zTJDpHjzUgu7vMS9zHpvbVE4FFXAPBVsEXFnK4DSF6uYEZCBZCbaSTIgZA9GzPgs9DoqlEBWYE63UhE\").on('complete', function(data) {\n            var p = JSON.parse(data);\n            rest.get(\"https://graph.facebook.com/\" + p.data[0].id + \"/photos?access_token=AAACJ86JqXRUBAPzXmsaCNiZBttPxVLOtbw9P5zTJDpHjzUgu7vMS9zHpvbVE4FFXAPBVsEXFnK4DSF6uYEZCBZCbaSTIgZA9GzPgs9DoqlEBWYE63UhE\").on('complete', function(data) {\n                var k = JSON.parse(data);\n                var b = \"\";\n                for (var i in k.data) {\n                    console.log(k.data[i].images[0].source);\n                    b += '<br/><img src=\"' + k.data[i].images[0].source + '\">';\n                }\n                res.send(b);\n            });\n        });\n\t});\n});\n\napp.listen(8080);\nconsole.log('Started up successfully.');"]],"start1":0,"start2":0,"length1":0,"length2":31188}]],"length":31188}
{"contributors":[],"silentsave":false,"ts":1347043340911,"patch":[[{"diffs":[[0,"ick');\n\n"],[1,"//Configure path to ImageMagick\n//"],[0,"im.ident"]],"start1":338,"start2":338,"length1":16,"length2":50},{"diffs":[[0,"ntify';\n"],[1,"//"],[0,"im.conve"]],"start1":412,"start2":412,"length1":16,"length2":18},{"diffs":[[0,"onvert';"],[1,"\nim.identify.path = '/opt/local/bin/identify';\nim.convert.path = '/opt/local/bin/convert';"],[0,"\n\napp.us"]],"start1":451,"start2":451,"length1":16,"length2":106}]],"length":31314,"saved":false}
{"ts":1347049409889,"patch":[[{"diffs":[[0,"                "],[1,"//"],[0,"res.redirect('/'"]],"start1":26673,"start2":26673,"length1":32,"length2":34},{"diffs":[[0,"ies/list');\n"],[1,"                    res.send('success');\n"],[0,"\t\t\t\t} else {"]],"start1":26734,"start2":26734,"length1":24,"length2":65}]],"length":31357,"saved":false}
{"ts":1347049464996,"patch":[[{"diffs":[[0,"    "],[-1,"res.send('success');\n\t\t\t\t} else {"],[1,"console.log('right');\n                    res.send('success');\n\t\t\t\t} else {\n                    console.log('wrong');"],[0,"\n   "]],"start1":26762,"start2":26762,"length1":41,"length2":125}]],"length":31441,"saved":false}
{"ts":1347049524748,"patch":[[{"diffs":[[0,"og('"],[-1,"right"],[1,"Correct Password"],[0,"');\n"]],"start1":26775,"start2":26775,"length1":13,"length2":24},{"diffs":[[0,"og('"],[-1,"w"],[1,"W"],[0,"rong"],[1," Password"],[0,"');\n"]],"start1":26882,"start2":26882,"length1":13,"length2":22}]],"length":31461,"saved":false}
{"ts":1347049968270,"patch":[[{"diffs":[[0,"        "],[-1,"//"],[0,"res.redi"]],"start1":26681,"start2":26681,"length1":18,"length2":16},{"diffs":[[0,"');\n"],[-1,"                    res.send('success');\n"],[0,"\t\t\t\t"]],"start1":26793,"start2":26793,"length1":49,"length2":8}]],"length":31418,"saved":false}
{"ts":1347050718587,"patch":[[{"diffs":[[0,"\t\t});\n\t});\n});\n\n"],[1,"app.post('/users/list/logout', function(req, res) {\n    console.log('Logout by ' + req.body.user);\n    req.session.user = '';\n    req.session.password = '';\n    res.redirect('/users/list');\n});\n\n"],[0,"app.get('/', fun"]],"start1":26932,"start2":26932,"length1":32,"length2":227}]],"length":31613,"saved":false}
{"ts":1347050821448,"patch":[[{"diffs":[[0,"gout by ' + req."],[-1,"body"],[1,"session"],[0,".user);\n    req."]],"start1":27019,"start2":27019,"length1":36,"length2":39}]],"length":31616,"saved":false}
{"ts":1347050846524,"patch":[[{"diffs":[[0,"le.log('"],[-1,"l"],[1,"L"],[0,"ogin by "]],"start1":26303,"start2":26303,"length1":17,"length2":17}]],"length":31616,"saved":false}
{"ts":1347053178830,"patch":[[{"diffs":[[0,"images'));\n\n"],[1,"//"],[0,"app.get('/:u"]],"start1":879,"start2":879,"length1":24,"length2":26},{"diffs":[[0,"ion(req, res) {\n"],[1,"//"],[0,"    console.log("]],"start1":930,"start2":930,"length1":32,"length2":34},{"diffs":[[0," request');\n"],[1,"//"],[0,"    res.rend"]],"start1":973,"start2":973,"length1":24,"length2":26},{"diffs":[[0,"raw', {\n"],[1,"//"],[0,"\t\tlayout"]],"start1":1004,"start2":1004,"length1":16,"length2":18},{"diffs":[[0," false,\n"],[1,"//"],[0,"\t\tdata: "]],"start1":1023,"start2":1023,"length1":16,"length2":18},{"diffs":[[0,"ata: {}\n"],[1,"//"],[0,"\t});\n"],[1,"//"],[0,"});\n"],[-1,"\n"],[1,"//\n//"],[0,"app.get("]],"start1":1036,"start2":1036,"length1":26,"length2":34},{"diffs":[[0,"ion(req, res) {\n"],[1,"//"],[0,"    console.log("]],"start1":1105,"start2":1105,"length1":32,"length2":34},{"diffs":[[0," get');\n"],[1,"//"],[0,"\tres.sen"]],"start1":1153,"start2":1153,"length1":16,"length2":18},{"diffs":[[0,"'</form>');\n"],[1,"//"],[0,"});\n\nfunctio"]],"start1":1339,"start2":1339,"length1":24,"length2":26},{"diffs":[[0,"og('"],[-1,"n"],[1,"N"],[0,"ew user"],[-1,"'"],[1," ' + req.body.user"],[0,");\n\t"]],"start1":25528,"start2":25528,"length1":17,"length2":34}]],"length":31657,"saved":false}
{"ts":1347055935285,"patch":[[{"diffs":[[0,"es'));\n\n"],[-1,"//"],[0,"app.get("]],"start1":883,"start2":883,"length1":18,"length2":16},{"diffs":[[0,"ion(req, res) {\n"],[-1,"//"],[0,"    console.log("]],"start1":928,"start2":928,"length1":34,"length2":32},{"diffs":[[0,"uest');\n"],[-1,"//"],[0,"    res."]],"start1":973,"start2":973,"length1":18,"length2":16},{"diffs":[[0,"raw', {\n"],[-1,"//"],[0,"\t\tlayout"]],"start1":998,"start2":998,"length1":18,"length2":16},{"diffs":[[0," false,\n"],[-1,"//"],[0,"\t\tdata: "]],"start1":1015,"start2":1015,"length1":18,"length2":16},{"diffs":[[0," {}\n"],[-1,"//"],[0,"\t});\n"],[-1,"//"],[0,"});\n"],[-1,"//"],[0,"\n//a"]],"start1":1030,"start2":1030,"length1":23,"length2":17},{"diffs":[[0,"   console.log('"],[-1,"g"],[1,"G"],[0,"ot new photo pos"]],"start1":4782,"start2":4782,"length1":33,"length2":33}]],"length":31641,"saved":false}
{"contributors":[],"silentsave":false,"ts":1347319981972,"patch":[[{"diffs":[[0,"isten(80"],[-1,"80"],[0,");\nconso"]],"start1":31588,"start2":31588,"length1":18,"length2":16}]],"length":31639,"saved":false}
{"ts":1347319999292,"patch":[[{"diffs":[[0,"isten(80"],[1,"81"],[0,");\nconso"]],"start1":31588,"start2":31588,"length1":16,"length2":18}]],"length":31641,"saved":false}
{"ts":1347320013508,"patch":[[{"diffs":[[0,"sten(808"],[-1,"1"],[1,"0"],[0,");\nconso"]],"start1":31589,"start2":31589,"length1":17,"length2":17}]],"length":31641,"saved":false}
{"ts":1347320026360,"patch":[[{"diffs":[[0,"sten(808"],[-1,"0"],[1,"1"],[0,");\nconso"]],"start1":31589,"start2":31589,"length1":17,"length2":17}]],"length":31641,"saved":false}
{"ts":1347321524910,"patch":[[{"diffs":[[0,"req.body.user);\n"],[1,"    if((req.body.user!=null) && (req.body.password!=null)) {\n    "],[0,"    db.open(func"]],"start1":26349,"start2":26349,"length1":32,"length2":97},{"diffs":[[0,"tion(err, db) {\n"],[1,"    "],[0,"\t\tdb.collection("]],"start1":26446,"start2":26446,"length1":32,"length2":36},{"diffs":[[0,", collection) {\n"],[1,"    "],[0,"\t\t\tcollection.fi"]],"start1":26503,"start2":26503,"length1":32,"length2":36},{"diffs":[[0,"ction.findOne({\n"],[1,"    "],[0,"\t\t\t\t\"user\": req."]],"start1":26531,"start2":26531,"length1":32,"length2":36},{"diffs":[[0,": req.body.user\n"],[1,"    "],[0,"\t\t\t}, function(e"]],"start1":26561,"start2":26561,"length1":32,"length2":36},{"diffs":[[0,"document) {\n"],[1,"    "],[0,"\t\t\t\tif(docum"]],"start1":26601,"start2":26601,"length1":24,"length2":28},{"diffs":[[0,"                "],[1,"   "],[1," "],[0,"req.session.user"]],"start1":26670,"start2":26670,"length1":32,"length2":36},{"diffs":[[0," req.body.user;\n"],[1,"    "],[0,"                "]],"start1":26708,"start2":26708,"length1":32,"length2":36},{"diffs":[[0,"ssword;\n"],[1,"    "],[0,"\t       "]],"start1":26782,"start2":26782,"length1":16,"length2":20},{"diffs":[[0,"                "],[1,"    "],[0,"console.log('Cor"]],"start1":26870,"start2":26870,"length1":32,"length2":36},{"diffs":[[0,"Password');\n"],[1,"    "],[0,"\t\t\t\t} else {"]],"start1":26911,"start2":26911,"length1":24,"length2":28},{"diffs":[[0,"                "],[1,"    "],[0,"console.log('Wro"]],"start1":26944,"start2":26944,"length1":32,"length2":36},{"diffs":[[0,"                "],[1,"    "],[0,"res.redirect('ba"]],"start1":26999,"start2":26999,"length1":32,"length2":36},{"diffs":[[0,"ct('back');\n"],[1,"    "],[0,"\t\t\t\t}\n"],[1,"    "],[0,"\t\t\t\tdb.close"]],"start1":27029,"start2":27029,"length1":30,"length2":38},{"diffs":[[0,"lose();\n"],[1,"    "],[0,"\t\t\t});\n"],[1,"    "],[0,"\t\t});\n"],[-1,"\t});"],[1,"    \t});\n    }"],[0,"\n});\n\nap"]],"start1":27063,"start2":27063,"length1":33,"length2":51}]],"length":31780,"saved":false}
{"ts":1347321567641,"patch":[[{"diffs":[[0," if("],[-1,"("],[0,"req.body"],[-1,".user"],[0,"!=null)"],[-1," && (req.body.password!=null))"],[0," {\n "]],"start1":26368,"start2":26368,"length1":59,"length2":23}]],"length":31744,"saved":false}
{"ts":1347321776074,"patch":[[{"diffs":[[0,"body.user);\n"],[1,"    console.log(req.body);\n"],[0,"    if(req.b"]],"start1":26353,"start2":26353,"length1":24,"length2":51}]],"length":31771,"saved":false}
{"ts":1347321822438,"patch":[[{"diffs":[[0,"body"],[-1,"!=null"],[1,".user.length>0"],[0,") {\n"]],"start1":26403,"start2":26403,"length1":14,"length2":22}]],"length":31779,"saved":false}
{"ts":1347321825161,"patch":[[{"diffs":[[0,"r);\n"],[-1,"    console.log(req.body);\n"],[0,"    "]],"start1":26361,"start2":26361,"length1":35,"length2":8}]],"length":31752,"saved":false}
{"contributors":[],"silentsave":false,"ts":1347566325243,"patch":[[{"diffs":[[0,"sten(808"],[-1,"1"],[1,"0"],[0,");\nconso"]],"start1":31700,"start2":31700,"length1":17,"length2":17}]],"length":31752,"saved":false}
{"ts":1347567553165,"patch":[[{"diffs":[[0,"le.log('"],[-1,"upsert"],[1,"Coords update"],[0,"');\n\tdb."]],"start1":9861,"start2":9861,"length1":22,"length2":29}]],"length":31759,"saved":false}
{"ts":1347567738354,"patch":[[{"diffs":[[0,"\t\t});\n\t});\n});\n\n"],[1,"app.post('/:user/:gallery/updateLink', function(req, res) {\n    console.log('Link update');\n    db.open(function(err, db) {\n\t\tdb.collection('users', function(err, collection) {\n\t\t\tcollection.findOne({\n\t\t\t\t\"user\": req.params.user\n\t\t\t}, function(err, document) {\n\t\t\t\tvar gal = document.galleries[req.params.gallery];\n\t\t\t\tvar p = 0;\n\t\t\t\tfor (var i in gal) {\n\t\t\t\t\tif (gal[p].source.split('/').pop() == req.body.image) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tp += 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tgal[p].link = req.body.link;\n\t\t\t\tdocument.galleries[req.params.gallery] = gal;\n\t\t\t\tcollection.update({\n\t\t\t\t\t\"user\": req.params.user\n\t\t\t\t}, document, {\n\t\t\t\t\tupsert: true,\n\t\t\t\t\tsafe: true\n\t\t\t\t}, function(err, document) {\n\t\t\t\t\tdb.close();\n\t\t\t\t});\n\t\t\t\tres.redirect('back');\n\t\t\t});\n\t\t});\n\t});\n});\n\n"],[0,"app.post('/:user"]],"start1":10726,"start2":10726,"length1":32,"length2":804}]],"length":32531,"saved":false}
{"ts":1347568973839,"patch":[[{"diffs":[[0,"k update');\n"],[1,"    console.log(req.params.user + ' ' + req.params.gallery + ' ' + req.body.file);\n"],[0,"    db.open("]],"start1":10822,"start2":10822,"length1":24,"length2":107},{"diffs":[[0,"p() == req.body."],[-1,"imag"],[1,"fil"],[0,"e) {\n\t\t\t\t\t\tbreak"]],"start1":11216,"start2":11216,"length1":36,"length2":35}]],"length":32613,"saved":false}
{"ts":1347569123775,"patch":[[{"diffs":[[0,"log("],[-1,"req.params.user + ' ' + req.params.gallery + ' ' + "],[0,"req."]],"start1":10846,"start2":10846,"length1":59,"length2":8},{"diffs":[[0,"te photo');\n"],[1,"    console.log(req.body.file);\n"],[0,"\tdb.open(fun"]],"start1":11629,"start2":11629,"length1":24,"length2":56}]],"length":32594,"saved":false}
{"ts":1347569360696,"patch":[[{"diffs":[[0,"eq.body.file) {\n"],[1,"                        console.log('found ' +p);\n                        console.log(gal[p]);\n"],[0,"\t\t\t\t\t\tbreak;\n\t\t\t"]],"start1":11173,"start2":11173,"length1":32,"length2":127},{"diffs":[[0,"ody.file) {\n"],[1,"                        console.log('found ' +p);\n                        console.log(gal[p]);\n"],[0,"\t\t\t\t\t\tbreak;"]],"start1":12076,"start2":12076,"length1":24,"length2":119}]],"length":32784,"saved":false}
{"ts":1347570310812,"patch":[[{"diffs":[[0,"').pop()"],[-1,"+'.jpg';"],[0,";\n    \t\t"]],"start1":6145,"start2":6145,"length1":24,"length2":16}]],"length":32776,"saved":false}
{"ts":1347570468454,"patch":[[{"diffs":[[0,"');\n"],[-1,"    console.log(req.body.file);\n"],[0,"    "]],"start1":10822,"start2":10822,"length1":40,"length2":8},{"diffs":[[0,"tion(err, db) {\n"],[1,""],[0,"\t\tdb.collection("]],"start1":10842,"start2":10842,"length1":32,"length2":32},{"diffs":[[0,") {\n"],[-1,"                        console.log('found ' +p);\n                        console.log(gal[p]);\n"],[0,"\t\t\t\t"]],"start1":11145,"start2":11145,"length1":103,"length2":8},{"diffs":[[0,"');\n"],[-1,"    console.log(req.body.file);\n"],[0,"\tdb."]],"start1":11597,"start2":11597,"length1":40,"length2":8},{"diffs":[[0,"var i in gal) {\n"],[1,""],[0,"\t\t\t\t\tif (gal[p]."]],"start1":11845,"start2":11845,"length1":32,"length2":32},{"diffs":[[0,") {\n"],[-1,"                        console.log('found ' +p);\n                        console.log(gal[p]);\n"],[0,"\t\t\t\t"]],"start1":11917,"start2":11917,"length1":103,"length2":8}]],"length":32522,"saved":false}
{"contributors":[],"silentsave":false,"ts":1347914865848,"patch":[[{"diffs":[[0,"eMagick\n"],[-1,"//"],[0,"im.ident"]],"start1":370,"start2":370,"length1":18,"length2":16},{"diffs":[[0,"ntify';\n"],[-1,"//"],[0,"im.conve"]],"start1":410,"start2":410,"length1":18,"length2":16},{"diffs":[[0,"nvert';\n"],[1,"\n//Path for OSX\n//"],[0,"im.ident"]],"start1":448,"start2":448,"length1":16,"length2":34},{"diffs":[[0,"/bin/identify';\n"],[1,"//"],[0,"im.convert.path "]],"start1":504,"start2":504,"length1":32,"length2":34},{"diffs":[[0,"rams: req.params"],[1,",\n                                galleries: document.galleries"],[0,"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t"]],"start1":9453,"start2":9453,"length1":32,"length2":95},{"diffs":[[0,"q.params"],[1,",\n                                galleries: document.galleries"],[0,"\n\t\t\t\t\t\t\t"]],"start1":9697,"start2":9697,"length1":16,"length2":79},{"diffs":[[0,"ully.');"],[1,"\n"]],"start1":32656,"start2":32656,"length1":8,"length2":9}]],"length":32665,"saved":false}
{"contributors":[],"silentsave":false,"ts":1347991451728,"patch":[[{"diffs":[[0,"eMagick\n"],[1,"//"],[0,"im.ident"]],"start1":370,"start2":370,"length1":16,"length2":18},{"diffs":[[0,"ntify';\n"],[1,"//"],[0,"im.conve"]],"start1":412,"start2":412,"length1":16,"length2":18},{"diffs":[[0,"for OSX\n"],[-1,"//"],[0,"im.ident"]],"start1":468,"start2":468,"length1":18,"length2":16},{"diffs":[[0,"/bin/identify';\n"],[-1,"//"],[0,"im.convert.path "]],"start1":506,"start2":506,"length1":34,"length2":32},{"diffs":[[0,"rists';\n"],[1,"    var users = new Array();\n    db.open(function(err, db) {\n    \tdb.collection('users', function(err, collection) {\n\t\t\tcollection.find().toArray(function(err, document) {\n\t\t\t\tfor (var i = 0; i < document.length; i++) {\n\t\t\t\t\tusers[i] = document[i].user;\n\t\t\t\t}\n\t\t\t\tres.render('users', {\n\t\t\t\t\tlayout: false,\n\t\t\t\t\tdata: users\n\t\t\t\t});\n\t\t\t\tdb.close();\n\t\t\t});\n\t\t});\n\t});\n"],[0,"\tdb.open"]],"start1":9036,"start2":9036,"length1":16,"length2":381}]],"length":33030,"saved":false}
{"ts":1347991485779,"patch":[[{"diffs":[[0,"cument.galleries"],[1,",\n                                users: users"],[0,"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t"]],"start1":9881,"start2":9881,"length1":32,"length2":78},{"diffs":[[0,"alleries"],[1,",\n                                users: users"],[0,"\n\t\t\t\t\t\t\t"]],"start1":10171,"start2":10171,"length1":16,"length2":62}]],"length":33122,"saved":false}
{"ts":1347991586821,"patch":[[{"diffs":[[0,"sten(808"],[-1,"0"],[1,"1"],[0,");\nconso"]],"start1":33069,"start2":33069,"length1":17,"length2":17}]],"length":33122,"saved":false}
{"ts":1347992216000,"patch":[[{"diffs":[[0,"\t\t}\n"],[-1,"\t\t\t\tres.render('users', {\n\t\t\t\t\tlayout: false,\n\t\t\t\t\tdata: users\n\t\t\t\t});\n"],[0,"\t\t\t\t"]],"start1":9300,"start2":9300,"length1":79,"length2":8}]],"length":33051,"saved":false}
{"ts":1347992812762,"patch":[[{"diffs":[[0,"s';\n"],[-1,"    var users = new Array();\n    "],[1,"\t"],[0,"db.o"]],"start1":9040,"start2":9040,"length1":41,"length2":9},{"diffs":[[0,", db) {\n"],[-1,"    "],[1,"\t"],[0,"\tdb.coll"]],"start1":9065,"start2":9065,"length1":20,"length2":17},{"diffs":[[0,", collection) {\n"],[-1,"\t\t\t"],[1,"            var users = new Array();\n            "],[0,"collection.find("]],"start1":9110,"start2":9110,"length1":35,"length2":81},{"diffs":[[0,"ment) {\n"],[-1,"\t"],[1,"    "],[0,"\t\t\tfor ("]],"start1":9219,"start2":9219,"length1":17,"length2":20},{"diffs":[[0,"\t\t}\n"],[-1,"\t\t\t\tdb.close();\n\t\t\t});\n\t\t});\n\t});\n\tdb.open(function(err, db) {\n\t\tdb.collection('users', function(err, collection) {\n\t\t\t"],[1,"                "],[0,"coll"]],"start1":9314,"start2":9314,"length1":127,"length2":24},{"diffs":[[0,"ction.findOne({\n"],[-1,"\t"],[1,"        "],[0,"\t\t\t\"user\": req.p"]],"start1":9339,"start2":9339,"length1":33,"length2":40},{"diffs":[[0,"req.params.user\n"],[1,"    "],[0,"\t\t\t}, function(e"]],"start1":9374,"start2":9374,"length1":32,"length2":36},{"diffs":[[0,"rr, document) {\n"],[1,"    "],[0,"\t\t\t\tif (document"]],"start1":9410,"start2":9410,"length1":32,"length2":36},{"diffs":[[0,"document) {\n"],[1,"    "],[0,"\t\t\t\t\tif (doc"]],"start1":9438,"start2":9438,"length1":24,"length2":28},{"diffs":[[0,"gallery]) {\n"],[1,"    "],[0,"\t\t\t\t\t\tif (re"]],"start1":9493,"start2":9493,"length1":24,"length2":28},{"diffs":[[0,"('index', {\n"],[1,"    "],[0,"\t\t\t\t\t\t\tlayou"]],"start1":9566,"start2":9566,"length1":24,"length2":28},{"diffs":[[0,"\tlayout: false,\n"],[1,"    "],[0,"\t\t\t\t\t\t\tdata: {\n\t"]],"start1":9588,"start2":9588,"length1":32,"length2":36},{"diffs":[[0," \t\t\t\t\t\t\tdata: {\n"],[1,"    "],[0,"\t\t\t\t\t\t\t\timages: "]],"start1":9607,"start2":9607,"length1":32,"length2":36},{"diffs":[[0,"arams.gallery],\n"],[1,"    "],[0,"\t\t\t\t\t\t\t\tparams: "]],"start1":9667,"start2":9667,"length1":32,"length2":36},{"diffs":[[0,"                "],[1,"    "],[0,"galleries: docum"]],"start1":9731,"start2":9731,"length1":32,"length2":36},{"diffs":[[0,"                "],[1,"    "],[0,"users: users\n\t\t\t"]],"start1":9798,"start2":9798,"length1":32,"length2":36},{"diffs":[[0,"   users: users\n"],[1,"    "],[0,"\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}"]],"start1":9815,"start2":9815,"length1":32,"length2":36},{"diffs":[[0,"rs\n    \t\t\t\t\t\t\t}\n"],[1,"    "],[0,"\t\t\t\t\t\t});\n\t\t\t\t\t\t"]],"start1":9828,"start2":9828,"length1":32,"length2":36},{"diffs":[[0,"  \t\t\t\t\t\t});\n"],[1,"    "],[0,"\t\t\t\t\t\telse r"]],"start1":9846,"start2":9846,"length1":24,"length2":28},{"diffs":[[0,"'public', {\n"],[1,"    "],[0,"\t\t\t\t\t\t\tlayou"]],"start1":9884,"start2":9884,"length1":24,"length2":28},{"diffs":[[0,"out: false,\n"],[1,"    "],[0,"\t\t\t\t\t\t\tdata:"]],"start1":9910,"start2":9910,"length1":24,"length2":28},{"diffs":[[0,"\t\t\t\tdata: {\n"],[1,"    "],[0,"\t\t\t\t\t\t\t\timag"]],"start1":9929,"start2":9929,"length1":24,"length2":28},{"diffs":[[0,"llery],\n"],[1,"    "],[0,"\t\t\t\t\t\t\t\t"]],"start1":9993,"start2":9993,"length1":16,"length2":20},{"diffs":[[0,"ms: req.params,\n"],[1,"    "],[0,"                "]],"start1":10017,"start2":10017,"length1":32,"length2":36},{"diffs":[[0,"ment.galleries,\n"],[1,"    "],[0,"                "]],"start1":10084,"start2":10084,"length1":32,"length2":36},{"diffs":[[0,"sers: users\n"],[1,"    "],[0,"\t\t\t\t\t\t\t}\n\t\t\t"]],"start1":10137,"start2":10137,"length1":24,"length2":28},{"diffs":[[0,"   \t\t\t\t\t\t\t}\n"],[1,"    "],[0,"\t\t\t\t\t\t});\n\t\t"]],"start1":10150,"start2":10150,"length1":24,"length2":28},{"diffs":[[0,"\t\t\t\t});\n"],[1,"    "],[0,"\t\t\t\t\t}\n"],[1,"    "],[0,"\t\t\t\t\tels"]],"start1":10168,"start2":10168,"length1":23,"length2":31},{"diffs":[[0,"ist!');\n"],[1,"    "],[0,"\t\t\t\t}\n"],[1,"    "],[0,"\t\t\t\telse"]],"start1":10230,"start2":10230,"length1":22,"length2":30},{"diffs":[[0,"t exist!');\n"],[1,"    "],[0,"\t\t\t\tdb.close"]],"start1":10283,"start2":10283,"length1":24,"length2":28},{"diffs":[[0,"\t\t\t\tdb.close();\n"],[1,"    "],[0,"\t\t\t});\n"],[1,"\t\t\t});\n\t\t\t\n"],[0,"\t\t});\n\t});\n});\n\n"]],"start1":10299,"start2":10299,"length1":39,"length2":54}]],"length":33088,"saved":false}
{"ts":1347993155393,"patch":[[{"diffs":[[0,") {\n"],[-1,"            var users = new Array();\n            collection.find().toArray(function(err, document) {\n    \t\t\tfor (var i = 0; i < document.length; i++) {\n\t\t\t\t\tusers[i] = document[i].user;\n\t\t\t\t}\n                "],[1,"\t\t\t"],[0,"coll"]],"start1":9122,"start2":9122,"length1":216,"length2":11},{"diffs":[[0,"ndOne({\n"],[-1,"        "],[1,"\t"],[0,"\t\t\t\"user"]],"start1":9142,"start2":9142,"length1":24,"length2":17},{"diffs":[[0,"params.user\n"],[-1,"    "],[0,"\t\t\t}, functi"]],"start1":9166,"start2":9166,"length1":28,"length2":24},{"diffs":[[0,"document) {\n"],[-1,"    "],[0,"\t\t\t\tif (docu"]],"start1":9198,"start2":9198,"length1":28,"length2":24},{"diffs":[[0,"document) {\n"],[-1,"    "],[0,"\t\t\t\t\tif (doc"]],"start1":9218,"start2":9218,"length1":28,"length2":24},{"diffs":[[0,"gallery]) {\n"],[-1,"    "],[0,"\t\t\t\t\t\tif (re"]],"start1":9269,"start2":9269,"length1":28,"length2":24},{"diffs":[[0,"('index', {\n"],[-1,"    "],[0,"\t\t\t\t\t\t\tlayou"]],"start1":9338,"start2":9338,"length1":28,"length2":24},{"diffs":[[0,"\tlayout: false,\n"],[-1,"    "],[0,"\t\t\t\t\t\t\tdata: {\n "]],"start1":9356,"start2":9356,"length1":36,"length2":32},{"diffs":[[0,"\n\t\t\t\t\t\t\tdata: {\n"],[-1,"    "],[0,"\t\t\t\t\t\t\t\timages: "]],"start1":9371,"start2":9371,"length1":36,"length2":32},{"diffs":[[0,"arams.gallery],\n"],[-1,"    "],[0,"\t\t\t\t\t\t\t\tparams: "]],"start1":9427,"start2":9427,"length1":36,"length2":32},{"diffs":[[0,"                "],[-1," "],[-1,"   "],[0,"galleries: docum"]],"start1":9487,"start2":9487,"length1":36,"length2":32},{"diffs":[[0,"ries"],[-1,",\n                                    users: users\n    "],[1,"\n"],[0,"\t\t\t\t"]],"start1":9528,"start2":9528,"length1":63,"length2":9},{"diffs":[[0,"leries\n\t\t\t\t\t\t\t}\n"],[-1,"    "],[0,"\t\t\t\t\t\t});\n    \t\t"]],"start1":9526,"start2":9526,"length1":36,"length2":32},{"diffs":[[0,"}\n\t\t\t\t\t\t});\n"],[-1,"    "],[0,"\t\t\t\t\t\telse r"]],"start1":9540,"start2":9540,"length1":28,"length2":24},{"diffs":[[0,"'public', {\n"],[-1,"    "],[0,"\t\t\t\t\t\t\tlayou"]],"start1":9574,"start2":9574,"length1":28,"length2":24},{"diffs":[[0," false,\n"],[-1,"    "],[0,"\t\t\t\t\t\t\td"]],"start1":9600,"start2":9600,"length1":20,"length2":16},{"diffs":[[0,"data: {\n"],[-1,"    "],[0,"\t\t\t\t\t\t\t\t"]],"start1":9615,"start2":9615,"length1":20,"length2":16},{"diffs":[[0,"llery],\n"],[-1,"    "],[0,"\t\t\t\t\t\t\t\t"]],"start1":9671,"start2":9671,"length1":20,"length2":16},{"diffs":[[0,"ms: req.params,\n"],[-1,"    "],[0,"                "]],"start1":9691,"start2":9691,"length1":36,"length2":32},{"diffs":[[0,"ries"],[-1,",\n                                    users: users\n    "],[1,"\n"],[0,"\t\t\t\t"]],"start1":9764,"start2":9764,"length1":63,"length2":9},{"diffs":[[0,"es\n\t\t\t\t\t\t\t}\n"],[-1,"    "],[0,"\t\t\t\t\t\t});\n  "]],"start1":9766,"start2":9766,"length1":28,"length2":24},{"diffs":[[0,"});\n"],[-1,"    "],[0,"\t\t\t\t\t}\n"],[-1,"    "],[0,"\t\t\t\t"]],"start1":9784,"start2":9784,"length1":23,"length2":15},{"diffs":[[0,"t exist!');\n"],[-1,"    "],[0,"\t\t\t\t}\n"],[-1,"    "],[0,"\t\t\t\telse res"]],"start1":9830,"start2":9830,"length1":38,"length2":30},{"diffs":[[0,"t exist!');\n"],[-1,"    "],[0,"\t\t\t\tdb.close"]],"start1":9879,"start2":9879,"length1":28,"length2":24},{"diffs":[[0,"();\n"],[-1,"    "],[0,"\t\t\t});\n"],[-1,"\t\t\t});\n\t\t\t\n"],[0,"\t\t})"]],"start1":9903,"start2":9903,"length1":30,"length2":15},{"diffs":[[0,"sten(808"],[-1,"1"],[1,"0"],[0,");\nconso"]],"start1":32612,"start2":32612,"length1":17,"length2":17}]],"length":32665,"saved":false}
{"ts":1347993167460,"patch":[[{"diffs":[[0,"sten(808"],[-1,"0"],[1,"2"],[0,");\nconso"]],"start1":32612,"start2":32612,"length1":17,"length2":17}]],"length":32665,"saved":false}
{"ts":1347993243542,"patch":[[{"diffs":[[0,"rams"],[-1,",\n                                galleries: document.galleries"],[0,"\n"],[1,""],[0,"\t\t\t\t"]],"start1":9465,"start2":9465,"length1":72,"length2":9},{"diffs":[[0,"rams"],[-1,",\n                                galleries: document.galleries"],[0,"\n\t\t\t"]],"start1":9638,"start2":9638,"length1":71,"length2":8},{"diffs":[[0,"\t\t\t\tdb.close();\n"],[-1,""],[0,"\t\t\t});\n\t\t});\n\t})"]],"start1":9765,"start2":9765,"length1":32,"length2":32},{"diffs":[[0,"\t\t});\n\t});\n});\n\n"],[1,"app.get('/home/:user', function(req, res) {\n    //req.session.user = 'krists';\n    db.open(function(err, db) {\n\t\tdb.collection('users', function(err, collection) {\n            var users = new Array();\n            collection.find().toArray(function(err, document) {\n    \t\t\tfor (var i = 0; i < document.length; i++) {\n\t\t\t\t\tusers[i] = document[i].user;\n\t\t\t\t}\n                collection.findOne({\n        \t\t\t\"user\": req.params.user\n    \t\t\t}, function(err, document) {\n    \t\t\t\tif (document) {\n    \t\t\t\t\tif (document.galleries[req.params.gallery]) {\n    \t\t\t\t\t\tif (req.session.user == req.params.user) res.render('index', {\n    \t\t\t\t\t\t\tlayout: false,\n    \t\t\t\t\t\t\tdata: {\n    \t\t\t\t\t\t\t\timages: document.galleries[req.params.gallery],\n    \t\t\t\t\t\t\t\tparams: req.params,\n                                    galleries: document.galleries,\n                                    users: users\n    \t\t\t\t\t\t\t}\n    \t\t\t\t\t\t});\n    \t\t\t\t\t\telse res.render('public', {\n    \t\t\t\t\t\t\tlayout: false,\n    \t\t\t\t\t\t\tdata: {\n    \t\t\t\t\t\t\t\timages: document.galleries[req.params.gallery],\n    \t\t\t\t\t\t\t\tparams: req.params,\n                                    galleries: document.galleries,\n                                    users: users\n    \t\t\t\t\t\t\t}\n    \t\t\t\t\t\t});\n    \t\t\t\t\t}\n    \t\t\t\t\telse res.send('User does not exist!');\n    \t\t\t\t}\n    \t\t\t\telse res.send('User does not exist!');\n    \t\t\t\tdb.close();\n    \t\t\t});\n\t\t\t});\n\t\t\t\n\t\t});\n\t});\n});\n\n"],[0,"app.post('/:user"]],"start1":9788,"start2":9788,"length1":32,"length2":1420}]],"length":33927,"saved":false}
{"ts":1347993592921,"patch":[[{"diffs":[[0,"if (document) {\n"],[1,"                        var gallery = 'galleries';\n                        if(req.params.user=='users') gallery = 'users';\n"],[0,"    \t\t\t\t\tif (doc"]],"start1":10276,"start2":10276,"length1":32,"length2":155},{"diffs":[[0,"t.galleries["],[-1,"req.params."],[0,"gallery]) {\n"]],"start1":10435,"start2":10435,"length1":35,"length2":24},{"diffs":[[0,"t.galleries["],[-1,"req.params."],[0,"gallery],\n  "]],"start1":10604,"start2":10604,"length1":35,"length2":24},{"diffs":[[0," \t\t\t\t\t\t\tdata: {\n"],[1,""],[0,"    \t\t\t\t\t\t\t\timag"]],"start1":10868,"start2":10868,"length1":32,"length2":32},{"diffs":[[0,"t.galleries["],[-1,"req.params."],[0,"gallery],\n  "]],"start1":10911,"start2":10911,"length1":35,"length2":24}]],"length":34017,"saved":false}
{"ts":1347993682216,"patch":[[{"diffs":[[0,");\n\n"],[-1,"app.get('/:user/:gallery', function(req, res) {\n    //req.session.user = 'krists';\n\tdb.open(function(err, db) {\n\t\tdb.collection('users', function(err, collection) {\n\t\t\tcollection.findOne({\n\t\t\t\t\"user\": req.params.user\n\t\t\t}, function(err, document) {\n\t\t\t\tif (document) {\n\t\t\t\t\tif (document.galleries[req.params.gallery]) {\n\t\t\t\t\t\tif (req.session.user == req.params.user) res.render('index', {\n\t\t\t\t\t\t\tlayout: false,\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\timages: document.galleries[req.params.gallery],\n\t\t\t\t\t\t\t\tparams: req.params\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\telse res.render('public', {\n\t\t\t\t\t\t\tlayout: false,\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\timages: document.galleries[req.params.gallery],\n\t\t\t\t\t\t\t\tparams: req.params\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse res.send('Gallery does not exist!');\n\t\t\t\t}\n\t\t\t\telse res.send('User does not exist!');\n\t\t\t\tdb.close();\n\t\t\t});\n\t\t});\n\t});\n});\n\n"],[0,"app."]],"start1":8957,"start2":8957,"length1":851,"length2":8},{"diffs":[[0,"req, res) {\n"],[1,""],[0,"    //req.se"]],"start1":8993,"start2":8993,"length1":24,"length2":24},{"diffs":[[0,"tion(err, db) {\n"],[-1,"\t"],[1,"    "],[0,"\tdb.collection('"]],"start1":9056,"start2":9056,"length1":33,"length2":36},{"diffs":[[0,"\t\t});\n\t});\n});\n\n"],[1,"app.get('/:user/:gallery', function(req, res) {\n    //req.session.user = 'krists';\n\tdb.open(function(err, db) {\n\t\tdb.collection('users', function(err, collection) {\n\t\t\tcollection.findOne({\n\t\t\t\t\"user\": req.params.user\n\t\t\t}, function(err, document) {\n\t\t\t\tif (document) {\n\t\t\t\t\tif (document.galleries[req.params.gallery]) {\n\t\t\t\t\t\tif (req.session.user == req.params.user) res.render('index', {\n\t\t\t\t\t\t\tlayout: false,\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\timages: document.galleries[req.params.gallery],\n\t\t\t\t\t\t\t\tparams: req.params\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\telse res.render('public', {\n\t\t\t\t\t\t\tlayout: false,\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\timages: document.galleries[req.params.gallery],\n\t\t\t\t\t\t\t\tparams: req.params\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse res.send('Gallery does not exist!');\n\t\t\t\t}\n\t\t\t\telse res.send('User does not exist!');\n\t\t\t\tdb.close();\n\t\t\t});\n\t\t});\n\t});\n});\n\n"],[0,"app.post('/:user"]],"start1":10426,"start2":10426,"length1":32,"length2":875}]],"length":34020,"saved":false}
{"ts":1347993901168,"patch":[[{"diffs":[[0,"\telse res.send('"],[-1,"Us"],[1,"Gall"],[0,"er"],[1,"y"],[0," does not exist!"]],"start1":10287,"start2":10287,"length1":36,"length2":39}]],"length":34023,"saved":false}
{"ts":1347993915948,"patch":[[{"diffs":[[0,"e res.send('User"],[1,"y"],[0," does not exist!"]],"start1":10351,"start2":10351,"length1":32,"length2":33}]],"length":34024,"saved":false}
{"ts":1347993922227,"patch":[[{"diffs":[[0,"nd('User"],[-1,"y"],[0," does no"]],"start1":10359,"start2":10359,"length1":17,"length2":16}]],"length":34023,"saved":false}
{"ts":1347993959794,"patch":[[{"diffs":[[0," \t\t\t\"user\": "],[-1,"req.params.user"],[1,"'home'"],[0,"\n    \t\t\t}, f"]],"start1":9364,"start2":9364,"length1":39,"length2":30}]],"length":34014,"saved":false}
{"ts":1347994052880,"patch":[[{"diffs":[[0,"ion.user == "],[-1,"req.params.user"],[1,"'home'"],[0,") res.render"]],"start1":9632,"start2":9632,"length1":39,"length2":30}]],"length":34005,"saved":false}
{"ts":1347994212121,"patch":[[{"diffs":[[0,"\t\t\t\tparams: "],[-1,"req.params"],[1,"{'user':'home','gallery':gallery}"],[0,",\n          "]],"start1":9776,"start2":9776,"length1":34,"length2":57},{"diffs":[[0,"params: "],[-1,"req.params"],[1,"{'user':'home','gallery':gallery}"],[0,",\n      "]],"start1":10110,"start2":10110,"length1":26,"length2":49}]],"length":34051,"saved":false}
{"ts":1347994510706,"patch":[[{"diffs":[[0," = 'users';\n"],[1,"                        console.log(gallery);\n"],[0,"    \t\t\t\t\tif "]],"start1":9554,"start2":9554,"length1":24,"length2":70}]],"length":34097,"saved":false}
{"ts":1347994550478,"patch":[[{"diffs":[[0,"s';\n"],[-1,"                        console.log(gallery);\n"],[0,"    "]],"start1":9562,"start2":9562,"length1":54,"length2":8}]],"length":34051,"saved":false}
{"ts":1347994939457,"patch":[[{"diffs":[[0,"    "],[-1,"            collection.findOne({\n        \t\t\t\"user\": 'home'\n    \t\t\t}, function(err, document) {\n    \t"],[0,"\t\t\ti"]],"start1":9320,"start2":9320,"length1":108,"length2":8},{"diffs":[[0,"if (document) {\n"],[-1,"    "],[0,"                "]],"start1":9327,"start2":9327,"length1":36,"length2":32},{"diffs":[[0,"eries';\n"],[-1,"    "],[0,"        "]],"start1":9382,"start2":9382,"length1":20,"length2":16},{"diffs":[[0,"s';\n    \t\t\t\t"],[-1,"\t"],[0,"if (document"]],"start1":9454,"start2":9454,"length1":25,"length2":24},{"diffs":[[0," {\n    \t\t\t\t\t"],[-1,"\t"],[0,"if (req.sess"]],"start1":9498,"start2":9498,"length1":25,"length2":24},{"diffs":[[0,"x', {\n    \t\t\t\t\t\t"],[-1,"\t"],[0,"layout: false,\n "]],"start1":9558,"start2":9558,"length1":33,"length2":32},{"diffs":[[0,"alse,\n    \t\t\t\t\t\t"],[-1,"\t"],[0,"data: {\n    \t\t\t\t"]],"start1":9583,"start2":9583,"length1":33,"length2":32},{"diffs":[[0,"a: {\n    \t\t\t\t\t\t\t"],[-1,"\t"],[0,"images: document"]],"start1":9602,"start2":9602,"length1":33,"length2":32},{"diffs":[[0,"ry],\n    \t\t\t\t\t\t\t"],[-1,"\t"],[0,"params: {'user':"]],"start1":9650,"start2":9650,"length1":33,"length2":32},{"diffs":[[0,"lery':gallery},\n"],[-1,"    "],[0,"                "]],"start1":9693,"start2":9693,"length1":36,"length2":32},{"diffs":[[0,"                "],[-1,"    "],[0,"users: users\n   "]],"start1":9788,"start2":9788,"length1":36,"length2":32},{"diffs":[[0,"users\n    \t\t\t\t\t\t"],[-1,"\t"],[0,"}\n    \t\t\t\t\t\t});\n"]],"start1":9811,"start2":9811,"length1":33,"length2":32},{"diffs":[[0,"\t\t\t\t\t}\n    \t\t\t\t\t"],[-1,"\t"],[0,"});\n    \t\t\t\t\t\tel"]],"start1":9822,"start2":9822,"length1":33,"length2":32},{"diffs":[[0,");\n    \t\t\t\t\t"],[-1,"\t"],[0,"else res.ren"]],"start1":9839,"start2":9839,"length1":25,"length2":24},{"diffs":[[0,"{\n    \t\t\t\t\t\t"],[-1,"\t"],[0,"layout: fals"]],"start1":9877,"start2":9877,"length1":25,"length2":24},{"diffs":[[0,",\n    \t\t\t\t\t\t"],[-1,"\t"],[0,"data: {\n    "]],"start1":9902,"start2":9902,"length1":25,"length2":24},{"diffs":[[0,"\n    \t\t\t\t\t\t\t"],[-1,"\t"],[0,"images: docu"]],"start1":9921,"start2":9921,"length1":25,"length2":24},{"diffs":[[0,"\n    \t\t\t\t\t\t\t"],[-1,"\t"],[0,"params: {'us"]],"start1":9969,"start2":9969,"length1":25,"length2":24},{"diffs":[[0,"lery':gallery},\n"],[-1,"    "],[0,"                "]],"start1":10008,"start2":10008,"length1":36,"length2":32},{"diffs":[[0,"                "],[-1,"    "],[0,"users: users\n   "]],"start1":10103,"start2":10103,"length1":36,"length2":32},{"diffs":[[0,"s\n    \t\t\t\t\t\t"],[-1,"\t"],[0,"}\n    \t\t\t\t\t\t"]],"start1":10130,"start2":10130,"length1":25,"length2":24},{"diffs":[[0,"\t\t\t\t\t}\n    \t\t\t\t\t"],[-1,"\t"],[0,"});\n    \t\t\t\t\t}\n "]],"start1":10137,"start2":10137,"length1":33,"length2":32},{"diffs":[[0,"});\n    \t\t\t\t"],[-1,"\t"],[0,"}\n    \t\t\t\t\te"]],"start1":10153,"start2":10153,"length1":25,"length2":24},{"diffs":[[0,"  \t\t\t\t}\n    \t\t\t\t"],[-1,"\t"],[0,"else res.send('G"]],"start1":10159,"start2":10159,"length1":33,"length2":32},{"diffs":[[0,"!');\n    \t\t\t"],[-1,"\t"],[0,"}\n    \t\t"],[-1,"\t"],[-1,"\t"],[0,"else res.sen"]],"start1":10212,"start2":10212,"length1":35,"length2":32},{"diffs":[[0,"t!');\n    \t\t"],[-1,"\t\t"],[0,"db.close();\n"]],"start1":10265,"start2":10265,"length1":26,"length2":24},{"diffs":[[0,"lose();\n"],[-1,"    \t\t\t});\n"],[0,"\t\t\t});\n\t"]],"start1":10281,"start2":10281,"length1":27,"length2":16}]],"length":33894,"saved":false}
{"ts":1347995144615,"patch":[[{"diffs":[[0,"document) {\n"],[1,"                var j = 0;\n"],[0,"    \t\t\tfor ("]],"start1":9217,"start2":9217,"length1":24,"length2":51},{"diffs":[[0,"er;\n"],[-1,"\t\t\t\t}\n    \t\t\t"],[1,"                    "],[0,"if"],[-1," "],[0,"(doc"]],"start1":9337,"start2":9337,"length1":24,"length2":30},{"diffs":[[0," if(document"],[-1,") {\n    "],[1,"[i].user==req.params.user) j = i;\n\t\t\t\t}\n"],[0,"            "]],"start1":9360,"start2":9360,"length1":32,"length2":64},{"diffs":[[0,"        "],[-1,"   "],[-1," "],[0,"if(req.p"]],"start1":9463,"start2":9463,"length1":20,"length2":16},{"diffs":[[0,"\n    \t\t\t"],[-1,"\t"],[0,"if (docu"]],"start1":9518,"start2":9518,"length1":17,"length2":16},{"diffs":[[0," \t\t\tif (document"],[1,"[j]"],[0,".galleries[galle"]],"start1":9522,"start2":9522,"length1":32,"length2":35},{"diffs":[[0,") {\n    \t\t\t\t"],[-1,"\t"],[0,"if (req.sess"]],"start1":9560,"start2":9560,"length1":25,"length2":24},{"diffs":[[0,"ex', {\n    \t\t\t\t\t"],[-1,"\t"],[0,"layout: false,\n "]],"start1":9619,"start2":9619,"length1":33,"length2":32},{"diffs":[[0,"false,\n    \t\t\t\t\t"],[-1,"\t"],[0,"data: {\n    \t\t\t\t"]],"start1":9643,"start2":9643,"length1":33,"length2":32},{"diffs":[[0,"ta: {\n    \t\t\t\t\t\t"],[-1,"\t"],[0,"images: document"]],"start1":9661,"start2":9661,"length1":33,"length2":32},{"diffs":[[0,"images: document"],[1,"[j]"],[0,".galleries[galle"]],"start1":9677,"start2":9677,"length1":32,"length2":35},{"diffs":[[0,"ery],\n    \t\t\t\t\t\t"],[-1,"\t"],[0,"params: {'user':"]],"start1":9711,"start2":9711,"length1":33,"length2":32},{"diffs":[[0,"                "],[-1,"    "],[0,"galleries: docum"]],"start1":9782,"start2":9782,"length1":36,"length2":32},{"diffs":[[0,"leries: document"],[1,"[j]"],[0,".galleries,\n    "]],"start1":9801,"start2":9801,"length1":32,"length2":35},{"diffs":[[0,"t[j].galleries,\n"],[-1,"    "],[0,"                "]],"start1":9816,"start2":9816,"length1":36,"length2":32},{"diffs":[[0," users\n    \t\t\t\t\t"],[-1,"\t"],[0,"}\n    \t\t\t\t\t});\n "]],"start1":9866,"start2":9866,"length1":33,"length2":32},{"diffs":[[0," \t\t\t\t\t}\n    \t\t\t\t"],[-1,"\t"],[0,"});\n    \t\t\t\t\tels"]],"start1":9876,"start2":9876,"length1":33,"length2":32},{"diffs":[[0,"});\n    \t\t\t\t"],[-1,"\t"],[0,"else res.ren"]],"start1":9892,"start2":9892,"length1":25,"length2":24},{"diffs":[[0," {\n    \t\t\t\t\t"],[-1,"\t"],[0,"layout: fals"]],"start1":9929,"start2":9929,"length1":25,"length2":24},{"diffs":[[0,"e,\n    \t\t\t\t\t"],[-1,"\t"],[0,"data: {\n    "]],"start1":9953,"start2":9953,"length1":25,"length2":24},{"diffs":[[0,"{\n    \t\t\t\t\t\t"],[-1,"\t"],[0,"images: docu"]],"start1":9971,"start2":9971,"length1":25,"length2":24},{"diffs":[[0,"images: document"],[1,"[j]"],[0,".galleries[galle"]],"start1":9983,"start2":9983,"length1":32,"length2":35},{"diffs":[[0,",\n    \t\t\t\t\t\t"],[-1,"\t"],[0,"params: {'us"]],"start1":10021,"start2":10021,"length1":25,"length2":24},{"diffs":[[0,"                "],[-1,"    "],[0,"galleries: docum"]],"start1":10088,"start2":10088,"length1":36,"length2":32},{"diffs":[[0,"leries: document"],[1,"[j]"],[0,".galleries,\n    "]],"start1":10107,"start2":10107,"length1":32,"length2":35},{"diffs":[[0,"t[j].galleries,\n"],[-1,"    "],[0,"                "]],"start1":10122,"start2":10122,"length1":36,"length2":32},{"diffs":[[0,"rs\n    \t\t\t\t\t"],[-1,"\t"],[0,"}\n    \t\t\t\t\t}"]],"start1":10176,"start2":10176,"length1":25,"length2":24},{"diffs":[[0,"\t\t\t\t"],[-1,"\t});\n    \t\t\t\t}\n    \t\t\t\telse res.send('Gallery does not exist!'"],[1,"}"],[0,");\n "]],"start1":10194,"start2":10194,"length1":70,"length2":9},{"diffs":[[0,";\n\t\t\t});"],[-1,"\n\t\t\t"],[0,""],[1,""],[0,"\n\t\t});\n\t"]],"start1":10272,"start2":10272,"length1":20,"length2":16}]],"length":33875,"saved":false}
{"ts":1347995398893,"patch":[[{"diffs":[[0,"     if("],[1,"("],[0,"document"]],"start1":9356,"start2":9356,"length1":16,"length2":17},{"diffs":[[0,"ms.user)"],[1," || (document[i].user=='users'))"],[0," j = i;\n"]],"start1":9391,"start2":9391,"length1":16,"length2":48}]],"length":33908,"saved":false}
{"ts":1347995448121,"patch":[[{"diffs":[[0," = i;\n\t\t\t\t}\n"],[1,"                console.log(document[j]);\n"],[0,"            "]],"start1":9433,"start2":9433,"length1":24,"length2":66}]],"length":33950,"saved":false}
{"ts":1347995535795,"patch":[[{"diffs":[[0,"     if("],[-1,"("],[0,"document"]],"start1":9356,"start2":9356,"length1":17,"length2":16},{"diffs":[[0,"er) "],[-1,"|| (document[i]"],[1,"j = i;\n                    if((document[i].user=='home') && (req.params"],[0,".use"]],"start1":9395,"start2":9395,"length1":23,"length2":79}]],"length":34005,"saved":false}
{"ts":1347995543632,"patch":[[{"diffs":[[0,"\t\t}\n"],[-1,"                console.log(document[j]);\n"],[0,"    "]],"start1":9496,"start2":9496,"length1":50,"length2":8}]],"length":33963,"saved":false}
{"ts":1347995758189,"patch":[[{"diffs":[[0,"gallery':gallery"],[1,", 'u':req.params.user"],[0,"},\n             "]],"start1":9839,"start2":9839,"length1":32,"length2":53},{"diffs":[[0,"s[gallery],\n    "],[-1,"\t"],[1,"    "],[0,"\t\t\t\t\tparams: {'u"]],"start1":10120,"start2":10120,"length1":33,"length2":36},{"diffs":[[0,":gallery"],[1,", 'u':req.params.user"],[0,"},\n     "]],"start1":10177,"start2":10177,"length1":16,"length2":37}]],"length":34008,"saved":false}
{"contributors":[],"silentsave":false,"ts":1348002698785,"patch":[[{"diffs":[[0,"t('/"],[-1,"krists/home"],[1,"home/users"],[0,"');\n"]],"start1":29586,"start2":29586,"length1":19,"length2":18}]],"length":34007,"saved":false}
{"ts":1348002744099,"patch":[[{"diffs":[[0,"e/users');\n});\n\n"],[1,"//"],[0,"app.get('/admin'"]],"start1":29593,"start2":29593,"length1":32,"length2":34},{"diffs":[[0,"ion(req, res) {\n"],[1,"//"],[0,"\tdb.open(functio"]],"start1":29634,"start2":29634,"length1":32,"length2":34},{"diffs":[[0,"tion(err, db) {\n"],[1,"//"],[0,"\t\tdb.collection("]],"start1":29665,"start2":29665,"length1":32,"length2":34},{"diffs":[[0,", collection) {\n"],[1,"//"],[0,"\t\t\tcollection.fi"]],"start1":29720,"start2":29720,"length1":32,"length2":34},{"diffs":[[0,"rr, document) {\n"],[1,"//"],[0,"\t\t\t\tvar users = "]],"start1":29777,"start2":29777,"length1":32,"length2":34},{"diffs":[[0,"ew Array();\n"],[1,"//"],[0,"\t\t\t\tfor (var"]],"start1":29812,"start2":29812,"length1":24,"length2":26},{"diffs":[[0,".length; i++) {\n"],[1,"//"],[0,"\t\t\t\t\tusers[i] = "]],"start1":29858,"start2":29858,"length1":32,"length2":34},{"diffs":[[0,"].user;\n"],[1,"//"],[0,"\t\t\t\t}\n"],[1,"//"],[0,"\t\t\t\tres."]],"start1":29902,"start2":29902,"length1":22,"length2":26},{"diffs":[[0,"('users', {\n"],[1,"//"],[0,"\t\t\t\t\tlayout:"]],"start1":29934,"start2":29934,"length1":24,"length2":26},{"diffs":[[0,"\tlayout: false,\n"],[1,"//"],[0,"\t\t\t\t\tdata: users"]],"start1":29952,"start2":29952,"length1":32,"length2":34},{"diffs":[[0,": users\n"],[1,"//"],[0,"\t\t\t\t});\n"],[1,"//"],[0,"\t\t\t\tdb.c"]],"start1":29979,"start2":29979,"length1":24,"length2":28},{"diffs":[[0,"lose();\n"],[1,"//"],[0,"\t\t\t});\n"],[1,"//"],[0,"\t\t});\n"],[1,"//"],[0,"\t});\n"],[1,"//"],[0,"});\n\napp"]],"start1":30007,"start2":30007,"length1":34,"length2":42}]],"length":34041,"saved":false}
{"ts":1348003675317,"patch":[[{"diffs":[[0," = i;\n\t\t\t\t}\n"],[1,"                var u = req.params.user;\n"],[0,"            "]],"start1":9488,"start2":9488,"length1":24,"length2":65},{"diffs":[[0," = 'users';\n"],[1,"                if(req.params.user=='galleries') u = 'galleries';\n"],[0,"    \t\t\tif (d"]],"start1":9636,"start2":9636,"length1":24,"length2":90},{"diffs":[[0,"allery, 'u':"],[-1,"req.params.user"],[1," u"],[0,"},\n         "]],"start1":9956,"start2":9956,"length1":39,"length2":26}]],"length":34135,"saved":false}
{"ts":1348003732939,"patch":[[{"diffs":[[0,"s')) j = i;\n"],[1,"                    if((document[i].user=='home') && (req.params.user=='galleries')) j = i;\n"],[0,"\t\t\t\t}\n      "]],"start1":9482,"start2":9482,"length1":24,"length2":116}]],"length":34227,"saved":false}
{"ts":1348013530486,"patch":[[{"diffs":[[0,"er=="],[-1,"req.params.user) j = i;\n                    if((document[i].user=='home') && (req.params.user=='users')"],[1,"'home'"],[0,") j "]],"start1":9378,"start2":9378,"length1":111,"length2":14},{"diffs":[[0,".user=='"],[-1,"gallerie"],[1,"user"],[0,"s')) j ="]],"start1":9461,"start2":9461,"length1":24,"length2":20}]],"length":34126,"saved":false}
{"ts":1348013750996,"patch":[[{"diffs":[[0,"].user=="],[-1,"'home'"],[1,"req.params.user) j = i;\n                    if((document[i].user=='home') && (req.params.user=='users')"],[0,") j = i;"]],"start1":9374,"start2":9374,"length1":22,"length2":119},{"diffs":[[0,"q.params.user=='"],[-1,"user"],[1,"gallerie"],[0,"s')) j = i;\n\t\t\t\t"]],"start1":9550,"start2":9550,"length1":36,"length2":40}]],"length":34227,"saved":false}
{"ts":1348013962557,"patch":[[{"diffs":[[0," var j = 0;\n"],[1,"                var k = 0;\n"],[0,"    \t\t\tfor ("]],"start1":9244,"start2":9244,"length1":24,"length2":51},{"diffs":[[0,"gth; i++) {\n"],[-1,""],[0,"\t\t\t\t\tusers[i"]],"start1":9322,"start2":9322,"length1":24,"length2":24},{"diffs":[[0,"=='users')) "],[-1,"j"],[1,"k"],[0," = i;\n      "]],"start1":9502,"start2":9502,"length1":25,"length2":25},{"diffs":[[0,"ries')) "],[-1,"j"],[1,"k"],[0," = i;\n\t\t"]],"start1":9598,"start2":9598,"length1":17,"length2":17},{"diffs":[[0,"\t\t\tif (document["],[-1,"j"],[1,"k"],[0,"].galleries[gall"]],"start1":9837,"start2":9837,"length1":33,"length2":33},{"diffs":[[0,"mages: document["],[-1,"j"],[1,"k"],[0,"].galleries[gall"]],"start1":9992,"start2":9992,"length1":33,"length2":33},{"diffs":[[0,"mages: document["],[-1,"j"],[1,"k"],[0,"].galleries[gall"]],"start1":10306,"start2":10306,"length1":33,"length2":33},{"diffs":[[0,"ry, 'u':"],[-1,"req.params.user"],[1," u"],[0,"},\n     "]],"start1":10396,"start2":10396,"length1":31,"length2":18}]],"length":34241,"saved":false}
{"ts":1348014026799,"patch":[[{"diffs":[[0,"             if("],[-1,"("],[0,"document[i].user"]],"start1":9440,"start2":9440,"length1":33,"length2":32},{"diffs":[[0,"me')"],[-1," && (req.params.user=='users')) k = i;\n                    if((document[i].user=='home') && (req.params.user=='galleries'))"],[0," k ="]],"start1":9477,"start2":9477,"length1":131,"length2":8}]],"length":34117,"saved":false}
{"ts":1348014245414,"patch":[[{"diffs":[[0,"             if("],[1,"("],[0,"document[i].user"]],"start1":9440,"start2":9440,"length1":32,"length2":33},{"diffs":[[0,"='home')"],[1," && ((req.params.user=='users') || (req.params.user=='galleries')))"],[0," k = i;\n"]],"start1":9474,"start2":9474,"length1":16,"length2":83}]],"length":34185,"saved":false}
{"ts":1348014306200,"patch":[[{"diffs":[[0,"e') && ("],[1,"(req.params.user=='home') || "],[0,"(req.par"]],"start1":9479,"start2":9479,"length1":16,"length2":45}]],"length":34214,"saved":false}
{"ts":1348014328850,"patch":[[{"diffs":[[0,"me')"],[-1," && ((req.params.user=='home') || (req.params.user=='users') || (req.params.user=='galleries'))"],[0,") k "]],"start1":9478,"start2":9478,"length1":103,"length2":8}]],"length":34119,"saved":false}
{"contributors":[],"silentsave":false,"ts":1348706067572,"patch":[[{"diffs":[[0,"eMagick\n"],[-1,"//"],[0,"im.ident"]],"start1":370,"start2":370,"length1":18,"length2":16},{"diffs":[[0,"ntify';\n"],[-1,"//"],[0,"im.conve"]],"start1":410,"start2":410,"length1":18,"length2":16},{"diffs":[[0,"for OSX\n"],[1,"//"],[0,"im.ident"]],"start1":464,"start2":464,"length1":16,"length2":18},{"diffs":[[0,"/bin/identify';\n"],[1,"//"],[0,"im.convert.path "]],"start1":504,"start2":504,"length1":32,"length2":34},{"diffs":[[0,"rr, document) {\n"],[1,"                        console.log('Logged in user ' + req.session.user);\n"],[0,"                "]],"start1":28346,"start2":28346,"length1":32,"length2":107},{"diffs":[[0," req.body.user;\n"],[-1,""],[0,"                "]],"start1":28479,"start2":28479,"length1":32,"length2":32},{"diffs":[[0,"\tres.redirect('/"],[1,"home/"],[0,"' + req.body.use"]],"start1":28597,"start2":28597,"length1":32,"length2":37},{"diffs":[[0,"ody.user"],[-1," + '/galleries/list'"],[0,");\n\t\t\t})"]],"start1":28627,"start2":28627,"length1":36,"length2":16},{"diffs":[[0,"irect('/"],[1,"home/"],[0,"' + req."]],"start1":29183,"start2":29183,"length1":16,"length2":21},{"diffs":[[0,"user"],[-1," + '/galleries/list'"],[0,");\n "]],"start1":29209,"start2":29209,"length1":28,"length2":8},{"diffs":[[0,"  res.redirect('"],[-1,"back'"],[1,"/home/' + req.body.user"],[0,");\n    \t\t\t\t}\n   "]],"start1":29367,"start2":29367,"length1":37,"length2":55},{"diffs":[[0,"irect('/"],[1,"home/"],[0,"users"],[-1,"/list"],[0,"');\n});\n"]],"start1":29651,"start2":29651,"length1":26,"length2":26},{"diffs":[[0,"sten(808"],[-1,"2"],[1,"0"],[0,");\nconso"]],"start1":34129,"start2":34129,"length1":17,"length2":17}]],"length":34182,"saved":false}
{"ts":1348706094486,"patch":[[{"diffs":[[0,") {\n"],[-1,"                        console.log('Logged in user ' + req.session.user);\n"],[0,"    "]],"start1":28358,"start2":28358,"length1":83,"length2":8},{"diffs":[[0,"y.password;\n"],[1,"                        console.log('Logged in user ' + req.session.user);\n"],[0,"\t\t\t\t\t\tdb.clo"]],"start1":28474,"start2":28474,"length1":24,"length2":99}]],"length":34182,"saved":false}
{"ts":1348706225264,"patch":[[{"diffs":[[0,"y.password;\n"],[1,"\t\t\t\t\t\tdb.close();\n"],[0,"            "]],"start1":28474,"start2":28474,"length1":24,"length2":42},{"diffs":[[0,"    "],[-1,"console.log('Logged in user "],[1,"res.redirect('/home/"],[0,"' + req."],[-1,"session"],[1,"body"],[0,".use"]],"start1":28524,"start2":28524,"length1":51,"length2":40},{"diffs":[[0,"\t\t\t\t"],[-1,"\tdb.close();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t"],[1,"});\n\t\t\t\t} else {\n                    "],[0,"res."]],"start1":28569,"start2":28569,"length1":40,"length2":45},{"diffs":[[0,".user);\n"],[1,"\t\t\t\t}\n"],[0,"\t\t\t});\n\t"]],"start1":28642,"start2":28642,"length1":16,"length2":22}]],"length":34200,"saved":false}
{"ts":1348706628927,"patch":[[{"diffs":[[0,"log('got"],[-1,"ten"],[1," new"],[0," backgro"]],"start1":6996,"start2":6996,"length1":19,"length2":20}]],"length":34201,"saved":false}
